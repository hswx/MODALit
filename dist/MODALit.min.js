!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.MODALit=e()}(this,function(){"use strict";function t(t){var e=t.el&&"string"!=typeof t.el?t.el:a(t.el||'[data-toggle="modal"]'),i=e.length;2>i&&(e=0===i?0:e[0],i=0),this.options=s(t,u),i?[].forEach.call(e,this.init.bind(this)):this.init(e)}var e=document,i=t.prototype,a=function(t,i,a){return i=i||e,i=!t.match(/\s/)&&t[0].match(/(#|\.)/)?"#"===t[0]?i.getElementById(t.slice(1)):i.getElementsByClassName(t.slice(1)):i.querySelectorAll(t),a&&void 0!==i.length?i[0]:i},n=function(t){var e=0,i=window.innerHeight-30,n=t.firstElementChild,o=t.getAttribute("data-modal-media"),s=a(".content",n,1);if("ajax"===t.getAttribute("data-modal-media")){s.style.height="",[].forEach.call(n.children,function(t){e+=t.tagName.match(/(header|footer)/i)?t.clientHeight:0});var d=n.offsetHeight-e;s.clientHeight>d&&(s.style.height=d+"px")}else if("full"!==t.getAttribute("data-modal-width")&&/^(video|image)$/.test(o)){var r="image"===o?a("img",s,1):s.firstElementChild;r&&(n.style.width="",i<n.clientHeight+30&&(n.style.width=Math.round(i*(r.clientWidth/r.clientHeight)*.9)+"px"))}!t.classList.contains("backdrop")&&"full"!==t.getAttribute("data-modal-width")&&/^(centered|left|right)$/.test(t.getAttribute("data-modal-position"))&&(n.style.marginTop=-(n.offsetHeight/2)+"px")},o=function(t){t.setAttribute("data-modal-load",!0),n(t)},s=function(t,e){for(var i in e)try{e[i].constructor===Object?t[i]=s(t[i],e[i]):void 0===t[i]&&(t[i]=e[i])}catch(a){t[i]=e[i]}return t},d=function(t,i){var s,d,l=t&&t.getAttribute("data-target")?t.getAttribute("data-target"):i.target,h=l?a(l,0,1):"",u=t&&t.getAttribute("data-src")?t.getAttribute("data-src"):i.src;if(!h){h=e.createElement("div"),e.body.appendChild(h),t&&["title","content","footer"].forEach(function(e){null!==t.getAttribute("data-"+e)&&(i[e]=t.getAttribute("data-"+e))});var m=i.title?"<header><h3>"+i.title+"</h3></header>":"";if(s=u?'<span class="loader"></span>':i.content,s=s?'<div class="content">'+s+"</div>":"",i.footer){var f=i.action.fn?i.cancel:i.action;d='<footer><button type="button" data-modal-btn="dismiss" class="'+f["class"]+'">'+f.label+"</button>%%</footer>",d=d.replace("%%",i.action.fn?'<button type="button" data-modal-btn="action" class="'+i.action["class"]+'">'+i.action.label+"</button>":"")}else d='<span data-modal-btn="dismiss"></span>';h.innerHTML='<div class="dialog">'+m+s+d+"</div>"}if(["transition","position","width"].forEach(function(e){i[e]=t&&null!==t.getAttribute("data-"+e)?t.getAttribute("data-"+e):i[e],i[e]&&h.setAttribute("data-modal-"+e,i[e])}),h.classList.add("modalit"),h.setAttribute("aria-hidden","true"),i.backdrop&&h.classList.add("backdrop"),u){var b=a(".content",h,1),g=r(u,i.autoplay);h.setAttribute("data-modal-media",g[1]),h.addEventListener("modalit.load",function(){if("ajax"===g[1])c(u,function(t){b.innerHTML=t,o(h)});else if("image"===g[1]){var t=new Image;t.src=u,t.addEventListener("load",function(){b.innerHTML=t.outerHTML,o(h)})}else b.innerHTML=g[0],o(h)})}return n(h),h},r=function(t,e){var i=t.match(/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/),a=t.match(/\/\/(player\.)?vimeo\.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/),n=t.match(/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/),o=t.match(/^.+.(mp4|m4v|ogg|ogv|webm)$/),s=t.match(/source\.unsplash\.com\/?/),d=t.match(/^.+.(jpg|jpeg|gif|png|svg)$/i);if(o)return['<video src="'+t+'" width="640" height="360" controls="true"'+(e?" autoplay":"")+"></video>","video"];if(d||s)return[null,"image"];if(i&&11===i[1].length)t="//www.youtube.com/embed/"+i[1];else if(a&&a[3].length)t="//player.vimeo.com/video/"+a[3];else{if(!n||!n[2].length)return[null,"ajax"];t="//www.dailymotion.com/embed/video/"+n[2]}return['<iframe src="'+t+(e?"?autoplay=1":"")+'" allowfullscreen="true" width="640" height="360"></iframe>',"video"]},c=function(t,e){var i=new XMLHttpRequest;i.open("get",t),i.onload=function(){200==i.status?e(i.responseText):console.error("Request Error: "+i.status)},i.send()},l=function(t){t.preventDefault()},h=function(t,i){t?(e.body.classList.add(i),e.body.addEventListener("touchmove",l)):(e.body.classList.remove(i),e.body.removeEventListener("touchmove",l))},u={backdrop:!0,fixed:"fixed",position:"centered",footer:!0,action:{label:"OK","class":"btn primary"},cancel:{label:"Cancel","class":"btn light"},autoplay:!0,dismiss:{backdrop:!0,esc:!0}};return i.init=function(t){this.modal=d(t,this.options),t&&t.addEventListener("click",this.show.bind(this,this.modal))},i.show=function(t,i){var o=null,s=this.options;if(!t.getAttribute("data-modal-load")){var d=e.createEvent("Event");d.initEvent("modalit.load",!0,!1),t.dispatchEvent(d)}this.listner={},this.btn={trigger:i&&(i.currentTarget||i.target),action:a('[data-modal-btn="action"]',t,1),cancel:a('[data-modal-btn="dismiss"]',t,1)},this.btn.trigger&&this.btn.trigger.classList.add("active"),t.setAttribute("aria-hidden","false"),s.action.fn&&(this.listner.action=s.action.fn.bind(this),this.btn.action.addEventListener("click",this.listner.action)),s.cancel.fn&&(this.listner.cancel=s.cancel.fn.bind(this),this.btn.cancel.addEventListener("click",this.listner.cancel)),t.addEventListener("click",this.hide.bind(this)),s.dismiss.esc&&e.addEventListener("keyup",function(t){27===t.keyCode&&this.hide()}.bind(this)),window.addEventListener("resize",function(){clearTimeout(o),o=setTimeout(n.bind(null,t),200)}),n(t),this.modal=t,s.backdrop&&s.fixed&&h(!0,s.fixed)},i.hide=function(t){var e=this.options,i=!t||!!(e.dismiss.backdrop&&!this.modal.firstElementChild.contains(t.target)||this.btn.cancel.contains(t.target));i&&(this.modal.setAttribute("aria-hidden","true"),this.btn.trigger&&this.btn.trigger.classList.remove("active"),e.fixed&&e.backdrop&&h(!1,e.fixed),h(),this.listner.action&&this.btn.action.removeEventListener("click",this.listner.action),this.listner.cancel&&this.btn.cancel.removeEventListener("click",this.listner.cancel),"video"===this.modal.getAttribute("data-modal-media")&&(this.modal.removeAttribute("data-modal-load"),a(".content",this.modal,1).innerHTML=""))},t});