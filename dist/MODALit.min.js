/*
 Modalit v0.2.0
 https://knot-design.jp/modalit/

 Author: Yuji Hisamatsu (https://github.com/knot-design)

 Copyright (C) 2017 Knot Design
 Licensed under the MIT license (MIT)

*/
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.MODALit=e()}(this,function(){"use strict";function t(t){this.modal=[],this.element=t.el&&"string"!=typeof t.el?t.el:o(t.el||'[data-toggle="modal"]'),this.element.length<2&&(this.element=0===this.element.length?0:this.element[0]),this.options=r(t,b),this.element.length>1?[].forEach.call(this.element,this.init.bind(this)):this.init(this.element)}var e=document,i=window,n=t.prototype,a={capture:!0,passive:!0},s=["action","cancel"],o=function(t,i,n){return i=i||e,i=!t.match(/\s/)&&t[0].match(/(#|\.)/)?"#"===t[0]?i.getElementById(t.slice(1)):i.getElementsByClassName(t.slice(1)):i.querySelectorAll(t),n&&void 0!==i.length?i[0]:i},r=function(t,e){for(var i in e)try{e[i].constructor===Object?t[i]=r(t[i],e[i]):void 0===t[i]&&(t[i]=e[i])}catch(n){t[i]=e[i]}return t},l=function(t,i){var n,s,r=t&&t.getAttribute("data-target")?t.getAttribute("data-target"):i.target,l=r?o(r,0,1):"",m=t&&t.getAttribute("data-src")?t.getAttribute("data-src"):i.src;if(!l){l=e.createElement("div"),e.body.appendChild(l),t&&["title","content","footer"].forEach(function(e){null!==t.getAttribute("data-"+e)&&(i[e]=t.getAttribute("data-"+e))}),n='<div class="content">'+(m?'<span class="loader"></span>':i.content)+"</div>";var f=i.title?"<header><h3>"+i.title+"</h3></header>":"";if(i.footer){var b=i.action.fn?i.cancel:i.action;s='<footer><button type="button" data-modal-btn="dismiss" class="'+b["class"]+'">'+b.label+"</button>%%</footer>",s=s.replace("%%",i.action.fn?'<button type="button" data-modal-btn="action" class="'+i.action["class"]+'">'+i.action.label+"</button>":"")}else s='<span data-modal-btn="dismiss"></span>';l.innerHTML='<div class="dialog">'+f+n+s+"</div>"}if(["transition","position","width"].forEach(function(e){i[e]=t&&null!==t.getAttribute("data-"+e)?t.getAttribute("data-"+e):i[e],i[e]&&l.setAttribute("data-modal-"+e,i[e])}),l.classList.add("modalit"),l.setAttribute("aria-hidden","true"),i.backdrop&&l.classList.add("backdrop"),m){var v=o(".content",l,1),g=h(m,i.video.autoplay);l.setAttribute("data-modal-media",g[1]),l.addEventListener("modalit.load",function(){if(v.firstElementChild.classList.contains("loader"))if("ajax"===g[1])u(m,function(t){v.innerHTML=t,c(l)});else if("image"===g[1]){var t=new Image;t.addEventListener("load",function(){v.innerHTML=t.outerHTML,c(l)}),t.src=m}else v.innerHTML=g[0],v.firstElementChild.addEventListener("load",function(){c(l)})},a)}return d(l),l},d=function(t,e){var i=0,n=t.firstElementChild,a=t.getAttribute("data-modal-media"),s=o(".content",n,1);if(a&&"ajax"!==a){if("full"!==t.getAttribute("data-modal-width")&&/^(video|image)$/.test(a)){var r="image"===a?o("img",s,1):s.firstElementChild;r&&(setTimeout(function(){n.clientHeight<s.clientHeight&&(n.style.width=Math.round(n.clientHeight*(r.clientWidth/r.clientHeight))+"px")},e?360:1),e&&(n.style.width=""))}}else{s.style.height="",s.classList.remove("scrollable"),[].forEach.call(n.children,function(t){i+=t.tagName.match(/(header|footer)/i)?t.clientHeight:0});var l=n.offsetHeight-i;s.clientHeight>l&&(s.style.height=l+"px",s.classList.add("scrollable"))}!t.classList.contains("backdrop")&&"full"!==t.getAttribute("data-modal-width")&&/^(centered|left|right)$/.test(t.getAttribute("data-modal-position"))&&(n.style.marginTop=-(n.offsetHeight/2)+"px")},c=function(t){t.setAttribute("data-modal-load",!0),d(t)},h=function(t,e){var i=t.match(/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/),n=t.match(/\/\/(player\.)?vimeo\.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/),a=t.match(/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/),s=t.match(/^.+.(mp4|m4v|ogg|ogv|webm)$/),o=t.match(/source\.unsplash\.com\/?/),r=t.match(/^.+.(jpg|jpeg|gif|png|svg)$/i);if(s)return['<video src="'+t+'" width="640" height="360" controls="true"'+(e?" autoplay":"")+"></video>","video"];if(r||o)return[null,"image"];if(i&&11===i[1].length)t="//www.youtube.com/embed/"+i[1];else if(n&&n[3].length)t="//player.vimeo.com/video/"+n[3];else{if(!a||!a[2].length)return[null,"ajax"];t="//www.dailymotion.com/embed/video/"+a[2]}return['<iframe src="'+t+(e?"?autoplay=1":"")+'" allowfullscreen="true" width="640" height="360"></iframe>',"video"]},u=function(t,e){var i=new XMLHttpRequest;i.open("get",t),i.onload=function(){200==i.status?e(i.responseText):console.error("Request Error: "+i.status)},i.send()},m=function(t){var e=o('[aria-hidden="false"].modalit',0,1),i=o(".content",e,1),n=/^(video|image)/.test(e.getAttribute("data-modal-media"))||0;(n||!n&&(!i.classList.contains("scrollable")||i.classList.contains("scrollable")&&!i.contains(t.target)))&&t.preventDefault()},f=function(t){t?(e.body.style.overflowY="hidden",e.body.addEventListener("touchmove",m)):(e.body.style.overflowY="",e.body.removeEventListener("touchmove",m))},b={backdrop:!0,fixed:!0,position:"centered",footer:!0,action:{label:"OK","class":"btn primary"},cancel:{label:"Cancel","class":"btn light"},video:{autoplay:!1,destroy:!1},dismiss:{backdrop:!0,esc:!0}};return n.init=function(t){var e=l(t,this.options);void 0!==arguments[1]?this.modal[arguments[1]]=e:this.modal=e,t&&t.addEventListener("click",this.show.bind(this,e,arguments[1]),a)},n.show=function(t,n){var r=null,l=this.options;if(this.current=t,t.getAttribute("data-modal-media")){var c=e.createEvent("Event");c.initEvent("modalit.load",!0,!1),t.dispatchEvent(c)}this.btn={trigger:void 0!==n?this.element[n]:this.element,action:o('[data-modal-btn="action"]',t,1),cancel:o('[data-modal-btn="dismiss"]',t,1)},this.btn.trigger&&this.btn.trigger.classList.add("active"),t.setAttribute("aria-hidden","false"),d(t),this.listner={},s.forEach(function(t){l[t].fn&&(this.listner[t]=l[t].fn.bind(this),this.btn[t].addEventListener("click",this.listner[t]))}.bind(this)),t.addEventListener("click",this.hide.bind(this)),l.dismiss.esc&&e.addEventListener("keyup",this.hide.bind(this),a),i.addEventListener("resize",function(){clearTimeout(r),r=setTimeout(d(t,!0),200)}),l.backdrop&&l.fixed&&f(1)},n.hide=function(t){var e=!t;t&&(27===t.keyCode||this.options.dismiss.backdrop&&!this.current.firstElementChild.contains(t.target)||this.btn.cancel.contains(t.target))&&(e=!0),e&&(this.current.setAttribute("aria-hidden","true"),this.btn.trigger&&this.btn.trigger.classList.remove("active"),this.options.fixed&&this.options.backdrop&&f(),f(),s.forEach(function(t){this.listner[t]&&this.btn[t].removeEventListener("click",this.listner[t])}.bind(this)),this.listner={},"video"===this.current.getAttribute("data-modal-media")&&this.options.video.remove&&(this.current.removeAttribute("data-modal-load"),o(".content",this.current,1).innerHTML='<span class="loader"></span>'))},t});